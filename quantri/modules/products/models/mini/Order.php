<?php
 namespace quantri\modules\products\models;use Yii;class Order extends \yii\db\ActiveRecord{public static function tableName(){return 'tbl_order';}public function rules(){return[[['user_id','delivery_date','status','created_at','updated_at','userUpdated'],'integer'],[['status','created_at','updated_at','payment_orders'],'required'],[['fullname','email','address','user_ship','payment_orders'],'string','max'=>255],[['phone','mobile_ship'],'string','max'=>12],[['note'],'string'],];}public function attributeLabels(){return['order_id'=>'Order ID','user_id'=>'Người tiếp nhận','fullname'=>'Họ tên','email'=>'Email','payment_orders'=>'Cách thanh toán','phone'=>'Số điện thoại','address'=>'Địa chỉ','delivery_date'=>'Ngày nhận đơn','user_ship'=>'Nhân viên ship','mobile_ship'=>'Số điện nhân viên','status'=>'Trạng thái','created_at'=>'Ngày tạo','updated_at'=>'Ngày nhận','userUpdated'=>'Người tiếp nhận',];}public function getDetails(){return $this->hasMany(OrderDetail::className(),['order_id'=>'order_id']);}public function getVersions(){return $this->hasMany(OrderDetail::className(),['order_id'=>'order_id']);}public function getUser(){return $this->hasOne(\quantri\models\User::className(),['id'=>'userUpdated']);}public function getAllCustomerByPro($id_pro){$data=self::find()->alias('o')->select(['fullname','email','phone','address','o.order_id'])->joinWith(['details as d'=>function(\yii\db\ActiveQuery $query)use($id_pro){$query->where(['d.pro_id'=>$id_pro]);},],true)->all();return $data;}public function getCountOrder(){$data=self::find()->select(['order_id','fullname','phone','email','address','status']);$result['total']=$data->count();$result['not_activated']=$data->where('status=:status',[':status'=>0])->count();$result['rows']=$data->all();return $result;}}
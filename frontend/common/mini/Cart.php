<?php
 namespace frontend\common;use Yii;use yii\web\Session;class Cart{public function addCart($id,$idVersion=null,$arrData,$number=1){$session=Yii::$app->session;if($idVersion>0){if(!isset($session['cart'])){$arrData['versions']['amount_price_sale_1']=$number;$arrData['versions']['amount_price_2']=$arrData['versions']['amount_price_3']=0;$cart[$id.$idVersion]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'].'-'.$arrData['versions']['name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'date'=>$arrData['versions']['date'],'image'=>$arrData['imageOne']['image'],'amount'=>$number,'idVersion'=>$idVersion,'versions'=>$arrData['versions']];}else{$cart=$session['cart'];if(array_key_exists($id.$idVersion,$cart)){$arrData['versions']['amount_price_sale_1']=$cart[$id.$idVersion]['versions']['amount_price_sale_1']+$number;$arrData['versions']['amount_price_2']=$cart[$id.$idVersion]['versions']['amount_price_2'];$arrData['versions']['amount_price_3']=$cart[$id.$idVersion]['versions']['amount_price_3'];$cart[$id.$idVersion]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'].'-'.$arrData['versions']['name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'date'=>$arrData['versions']['date'],'image'=>$arrData['imageOne']['image'],'amount'=>$cart[$id.$idVersion]['amount']+$number,'idVersion'=>$idVersion,'versions'=>$arrData['versions']];}else{$arrData['versions']['amount_price_sale_1']=$number;$arrData['versions']['amount_price_2']=$arrData['versions']['amount_price_3']=0;$cart[$id.$idVersion]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'].'-'.$arrData['versions']['name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'date'=>$arrData['versions']['date'],'image'=>$arrData['imageOne']['image'],'amount'=>$number,'idVersion'=>$idVersion,'versions'=>$arrData['versions']];}}}else{if(!isset($session['cart'])){$cart[$id]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'price_sales'=>$arrData['price_sales'],'price'=>$arrData['price'],'start_sale'=>$arrData['start_sale'],'end_sale'=>$arrData['end_sale'],'image'=>$arrData['imageOne']['image'],'amount'=>$number,'idVersion'=>$idVersion,];}else{$cart=$session['cart'];if(array_key_exists($id,$cart)){$cart[$id]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'price_sales'=>$arrData['price_sales'],'price'=>$arrData['price'],'start_sale'=>$arrData['start_sale'],'end_sale'=>$arrData['end_sale'],'image'=>$arrData['imageOne']['image'],'amount'=>$cart[$id]['amount']+$number,'idVersion'=>$idVersion,];}else{$cart[$id]=['pro_id'=>$arrData['id'],'pro_name'=>$arrData['pro_name'],'slug'=>$arrData['slug'],'slugCate'=>$arrData['slugCate'],'price_sales'=>$arrData['price_sales'],'price'=>$arrData['price'],'start_sale'=>$arrData['start_sale'],'end_sale'=>$arrData['end_sale'],'image'=>$arrData['imageOne']['image'],'amount'=>$number,'idVersion'=>$idVersion,];}}}$session['cart']=$cart;}public function delItemCart($id){$session=Yii::$app->session;if(isset($session['cart'])){$cart=$session['cart'];unset($cart[$id]);$session['cart']=$cart;}}public function updateCart($id,$amount,$price_attribute=null){$session=Yii::$app->session;$cart=$session['cart'];if(array_key_exists($id,$cart)){if($price_attribute!=null){$cart[$id]['versions']['amount_'.$price_attribute]=$amount;}else{$cart[$id]['amount']=$amount;}$session['cart']=$cart;}}}